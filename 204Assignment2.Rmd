---
title: "Econ Assignment 2"
author: "Sidney Gerst"
date: "April 24, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include = FALSE}
###load packages and data
library(tidyverse)

Gas_Data <- read_csv("Gas_Data.csv")


```


1. a. what is the aggregate daily demand curve?
```{r include = FALSE }
#plot of the data with a lm fit to it
ggplot(Gas_Data)+
  geom_point(aes(x = Q_Low_Gallons_per_Day, y = Price_Dollars, color = "Low")) +
  geom_smooth(aes(x = Q_Low_Gallons_per_Day, y = Price_Dollars), color = "red", method = "lm", se = FALSE)+
  geom_point(aes(x = Q_High_Gallons_per_Day, y = Price_Dollars, color = "High")) +
  geom_smooth(aes(x = Q_High_Gallons_per_Day, y = Price_Dollars), color = "blue", method = "lm", se = FALSE)+
  theme_bw()

#linear regressions
low_lm <- lm(Price_Dollars ~ Q_Low_Gallons_per_Day, data = Gas_Data)

low_lm

summary(low_lm)



high_lm <- lm(Price_Dollars ~ Q_High_Gallons_per_Day, data = Gas_Data)

high_lm

#set the functions
Q_low <- function(x) {
  21.9908534-0.0001355*x
}

Q_high <- function(x) {
  23.3914418-0.0001297*x
}

mec <- function(y) {
  2
}

Q_agg <- function(x) {
  22.7064632349-0.00006626828*x
}

#5=22.71027063-6.62683E-05*x

supply <- function(x) {
  0.000018709*x
}

#set the functions on a graph
eq = function(x){x*x}
ggplot(data.frame(x=c(1, 50)), aes(x=x)) + stat_function(fun=eq, geom="line") + xlab("x") + ylab("y")

ggplot(data.frame(x = c(70000, 500000), y = c(0, 30)), aes(x = x, y = y)) + 
  stat_function(fun = Q_low, geom = "line", color = "red") + 
  stat_function(fun = Q_high, geom = "line", color = "blue") +
  stat_function(fun = mec, geom = "line", color = "green") +
  stat_function(fun = Q_agg, geom = "line", color = "brown") +
  stat_function(fun = supply, geom = "line", color = "yellow") +
  scale_x_continuous(expand = c(0,0), limits = c(0,500000)) +
  scale_y_continuous(expand = c(0,0), limits = c(0,25)) +
  xlab("Quantity (Gallons)") + 
  ylab("Price (Dollars)") +
  theme_bw()


low_cs <- 1377761.43584

high_cs <- 1611029.47484

#Consumer Benefit Status Quo
low_cs + high_cs #2988790.91068

#Producer Benefit Status Quo
#422620.964934


#Environmental Cost
#534412.56851





```





2. how is the current consumer benefit divided between "high" and "low" income consumers
```{r}

low_cs_fun <- function(y) {
  2.66798225954
}

high_cs_fun <- function(y) {
  2.94881364767
}


#q_test <- uniroot(function(x) Q_agg(x) - supply(x), range(x))$root
  # Q aggregate = 267176.2 gallons

q_t <-267176.2

# Equilibrium price
#p_test <- supply(q_test)
  # P = $5
z <- seq(0, q_t, 0.05)




ggplot(data.frame(x = c(70000, 500000), y = c(0, 30)), aes(x = x, y = y)) + 
  stat_function(aes(x, color = "Low Gallons Demand"), fun = Q_low) + 
  stat_function(aes(x, color = "High Gallons Demand"), fun = Q_high) +
  stat_function(aes(x, color = "Marginal Externality Cost"), fun = mec) +
  stat_function(aes(x, color = "Aggregate Demand"), fun = Q_agg) +
  stat_function(aes(x, color = "Supply"),fun = supply) +
  scale_x_continuous(expand = c(0,0), limits = c(0,500000)) +
  scale_y_continuous(expand = c(0,0), limits = c(0,25)) +
  xlab("Quantity (Gallons)") + 
  ylab("Price (Dollars)") +
  theme_bw()+
  annotate("point", x = q_t, y = 5, color = "grey30") + 
  annotate("segment", x = q_t, xend = q_t, y = 0, yend = 5, linetype = "dashed", color = "grey30") +
  annotate("segment", x = 0, xend = q_t, y = 5, yend = 5,linetype = "dashed", color = "grey30") 
  # geom_ribbon(aes(x = z, ymin = supply(z), ymax = 5,
  #                 fill = "Producer Surplus"), alpha = 0.25) +
  # geom_ribbon(aes(x = z, ymin = 5, ymax = Q_agg(z),
  #                 fill = "Aggregate Consumer Surplus"), alpha = 0.25) +
  # geom_ribbon(aes(x = z, ymin = 0, ymax = mec(z),
  #                 fill = "Environmental Cost"), alpha = 0.25)


#high_cs - low_cs #233268


```

High income has more benefit than low income by 233268 (UNITS?????)


3. GAS TAX OF $0.50/GALLON
```{r}

#tax function supply + 0.50
supply_tax <- function(x) {
  0.50 + 0.000018709*x
}

quantity_tax <- 261277.714261

price_tax <- 5.38824475611

ggplot(data.frame(x = c(70000, 500000), y = c(0, 30)), aes(x = x, y = y)) + 
  stat_function(aes(x, color = "Low Gallons Demand"), fun = Q_low) + 
  stat_function(aes(x, color = "High Gallons Demand"), fun = Q_high) +
  stat_function(aes(x, color = "Marginal Externality Cost"), fun = mec) +
  stat_function(aes(x, color = "Aggregate Demand"), fun = Q_agg) +
  stat_function(aes(x, color = "Supply"),fun = supply) +
  stat_function(aes(x, color = "Supply Tax"), fun = supply_tax) +
  scale_x_continuous(expand = c(0,0), limits = c(0,500000)) +
  scale_y_continuous(expand = c(0,0), limits = c(0,25)) +
  xlab("Quantity (Gallons)") + 
  ylab("Price (Dollars)") +
  theme_bw()+
  annotate("point", x = q_t, y = 5, color = "grey30") + 
  annotate("segment", x = q_t, xend = q_t, y = 0, yend = 5, linetype = "dashed", color = "grey30") +
  annotate("segment", x = 0, xend = q_t, y = 5, yend = 5,linetype = "dashed", color = "grey30")


low_cs_tax <- 1317487.94969

high_cs_tax <- 1542892.95988


#producer surplus
#Step 1: Find new quantity. This is where the supply_tax curve intersects the demand agg
q_t

#Step 2: Find the price of this quantity ON THE ORIGINAL SUPPLY CURVE --> new height
p_tax_agg <- supply(quantity_tax)


#Step 3: Find the area of the producer surplus
  #base = q_tax
  # height = p_tax_agg
ps_tax_50 <- .5*quantity_tax*p_tax_agg 

total_ps_tax <- 638594.708312246

#Environmental Damage

total_environmental_damage <- 2*quantity_tax #522555.428522

#Tax Revenue
tax_revenue <- quantity_tax * (price_tax - p_tax_agg) #130638.857130749




```



4. Revenue will be used for infrastructure repairs. ASSUME: low income consumers bear all environmental costs.
